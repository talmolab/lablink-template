# LabLink Test Environment Configuration
# For staging/pre-production testing with S3 backend
#
# Use this for:
# - Staging environment for pre-production validation
# - Testing with team before production deployment
# - CI/CD workflows with S3 state
#
# ⚠️ Rate Limit Consideration:
# - If using Let's Encrypt, limit to 1-2 deployments per week
# - For frequent testing, configure with CloudFlare SSL or IP-only
# - See config/README.md for SSL provider comparison
#
# Prerequisites:
# - S3 bucket for Terraform state
# - DynamoDB table for state locking
# - Route53 hosted zone (if using DNS)
# - GitHub secrets configured for test environment
#
# Setup:
#   cp lablink-infrastructure/config/test.example.yaml lablink-infrastructure/config/config.yaml
#   # Edit config.yaml with your values (domain, SSL provider, region, etc.)
#   ./scripts/setup-aws-infrastructure.sh  # Creates S3, DynamoDB, Route53
#   cd lablink-infrastructure
#   ../scripts/init-terraform.sh test
#   terraform apply -var="resource_suffix=test"
#
# Access URL: Depends on dns/ssl configuration

db:
  dbname: "lablink_db"
  user: "lablink"
  password: "PLACEHOLDER_DB_PASSWORD"  # Injected from GitHub secret at deploy time
  host: "localhost"
  port: 5432
  table_name: "vms"
  message_channel: "vm_updates"

machine:
  # Client VM instance type
  machine_type: "g4dn.xlarge"  # GPU instance for ML workloads

  # Docker image for client VMs (use test tags)
  image: "ghcr.io/talmolab/lablink-client-base-image:linux-amd64-latest-test"

  # AMI ID for your AWS region (Ubuntu 24.04 with Docker + Nvidia GPU Driver)
  ami_id: "ami-0601752c11b394251"  # us-west-2 Ubuntu 24.04 custom AMI

  # Git repository with test/tutorial data
  repository: "https://github.com/talmolab/sleap-tutorial-data.git"

  # Software identifier
  software: "sleap"

  # File extension
  extension: "slp"

# Allocator service configuration
allocator:
  # Use latest test image for test environment
  image_tag: "linux-amd64-latest-test"

app:
  admin_user: "admin"
  admin_password: "PLACEHOLDER_ADMIN_PASSWORD"  # Injected from GitHub secret at deploy time
  region: "us-west-2"

dns:
  # Enable DNS for test environment
  enabled: true
  terraform_managed: true  # Let Terraform manage DNS records
  domain: "test.lablink.example.com"  # Full domain name (supports sub-subdomains)
  zone_id: ""  # (Optional) Hardcode zone ID or leave empty for auto-lookup

eip:
  # Use persistent EIP for test (keeps same IP across redeploys)
  strategy: "persistent"  # Reuses existing EIP with matching tag
  tag_name: "lablink-eip"  # Will become lablink-eip-test

ssl:
  # Use Let's Encrypt for test (production certs - always HTTPS)
  provider: "letsencrypt"
  email: "admin@example.com"  # Your email for Let's Encrypt notifications
  certificate_arn: ""  # Not needed for letsencrypt

startup_script:
  enabled: false  # Enable custom startup script if needed
  path: "config/custom-startup.sh"
  on_error: "continue"

# S3 bucket for Terraform state (must be unique across ALL of AWS)
# Example: if your org is "acme", use "tf-state-lablink-acme"
bucket_name: "tf-state-lablink-YOURORG"  # Replace YOURORG with something unique
