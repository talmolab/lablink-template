# LabLink Configuration: Use Case 5 - Route53 + Let's Encrypt (Manual DNS)
# Use AWS Route53 for DNS but manually create A records (not Terraform-managed)
#
# Use this when:
# - You want Route53 DNS but don't want Terraform managing DNS records
# - You prefer to create/update DNS records manually in Route53 console
# - You're migrating from an existing setup
#
# Prerequisites:
# - Route53 hosted zone created
# - Manually create A record: test.lablink.example.com → {allocator_eip}
#
# ⚠️ IMPORTANT - Let's Encrypt Rate Limits:
# - 5 certificates per exact domain every 7 days (e.g., test.lablink.example.com)
# - Rate limit violations = 7-day lockout with NO override
# - Each terraform apply triggers a new certificate
# - For frequent testing, use cloudflare.example.yaml or ip-only.example.yaml instead
# - Monitor usage: https://crt.sh/?q=your-domain.com
# - See docs/TESTING_BEST_PRACTICES.md for rate limit strategies
#
# Setup:
# 1. Deploy infrastructure (get allocator EIP from output)
# 2. Manually create A record in Route53 console
# 3. Wait for DNS propagation
# 4. Access allocator URL (Caddy obtains Let's Encrypt cert)
#
# Access URL: https://test.lablink.example.com

db:
  dbname: "lablink_db"
  user: "lablink"
  password: "PLACEHOLDER_DB_PASSWORD"
  host: "localhost"
  port: 5432
  table_name: "vms"
  message_channel: "vm_updates"

machine:
  machine_type: "g4dn.xlarge"
  image: "ghcr.io/talmolab/lablink-client-base-image:linux-amd64-latest-test"
  ami_id: "ami-0601752c11b394251"  # us-west-2
  repository: "https://github.com/talmolab/sleap-tutorial-data.git"
  software: "sleap"
  extension: "slp"

allocator:
  image_tag: "linux-amd64-latest-test"

app:
  admin_user: "admin"
  admin_password: "PLACEHOLDER_ADMIN_PASSWORD"
  region: "us-west-2"

dns:
  enabled: true  # DNS expected (used for SSL certificate domain)
  terraform_managed: false  # Manual DNS - YOU create A record in Route53 console
  domain: "test.lablink.example.com"  # Full domain
  zone_id: ""  # Not needed for manual DNS

eip:
  strategy: "persistent"
  tag_name: "lablink-eip"

ssl:
  provider: "letsencrypt"  # Caddy auto-SSL with Let's Encrypt
  email: "admin@example.com"  # Required for Let's Encrypt notifications
  certificate_arn: ""

startup_script:
  enabled: false
  path: "config/custom-startup.sh"
  on_error: "continue"

bucket_name: "tf-state-lablink-YOURORG"